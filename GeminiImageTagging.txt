curl --location 'https://us-central1-aiplatform.googleapis.com/v1/projects/gcp-demo-prj-01/locations/us-central1/publishers/google/models/gemini-2.0-flash-exp:generateContent' \
--header 'Authorization: Bearer xwer3.O8GJXXXpd9uGoonINCGjx1m4Nu0UmrkumarNJq5ECKBlRIXB35AuSe4-De9BglrYzYaCgYKARgSARMSFQHGX2MiSMpoVenrbmPoWWN-kfj6NQ0426' \
--header 'Content-Type: text/plain' \
--data '{
    "contents": [{
      "role": "user",
      "parts": [
       {
          "text": "Tags = \"\"\"\n\"banners\": [\n\"SevenEleven\",\n\"Bazaar\",\n\"FarmerMarket\",\n\"Megamart'\''\'\'''\''s\",\n\"Victor\"\n],\n\"brands\": [\n\"Nature Choice\",\n\"BestBreakfast\",\n],\n\"seasonal\": [\n\"4th of July\",\n\"Back to School\",\n\"Christmas\",\n\"Cinco de Mayo\",\n\"Easter\",\n\"Evergreen\",\n\"Fall Autumn\",\n\"Fall Football\",\n\"Fathers Day\",\n\"Graduation\",\n\"Halloween\",\n\"Hanukkah\",\n\"Labor Day\",\n\"Lunar New Year\",\n\"Mardi Gras\",\n\"Memorial Day\",\n\"Mothers Day\",\n\"New Years Eve\",\n\"Oktoberfest\",\n\"Social Holidays\",\n\"Spring\",\n\"St. Patricks Day\",\n\"Summer\",\n\"Superbowl\",\n\"Thanksgiving\",\n\"Valentine'\''\'\'''\''s Day\",\n\"Winter\"\n],\n\"mealType\": [\n\"Appetizers\",\n\"Beverages\",\n\"Brunch\",\n\"Cocktails\",\n\"Condiments\",\n\"Dessert\",\n\"Dinner\",\n\"Lunch\",\n\"Main Course\",\n\"Salad\",\n\"Side Dishes\",\n\"Snacks\",\n\"Soups\",\n\"Weeknight Dinners\"\n],\n\"departments\": [\n\"Bakery\",\n\"Center Store\",\n\"Customer Service\",\n\"Dairy\",\n\"Deli\",\n\"Floral\",\n\"Front End\",\n\"Frozen\",\n\"Fuel Center\",\n\"Meat\",\n\"Pharmacy\",\n\"Produce\",\n\"Seafood\",\n\"Wine Or Beer Or Spirits Or TAB\"\n],\n\"\"\"\n\nexpected_format = \"\"\"metadata JSON should consist of the following keys:\nlist(items), list(probabilityMatch), description, altText, list(banners), list(brands), list(seasonal), list(mealType), list(departments)\nUse the following format to create metadata JSON and output only JSON:\n{\n\"items\":[list of items] ,\n\"probabilityMatch\":[probabilityMatch],\n\"description\":str,\n\"altText\":str,\n\"banners\":[list of banners] ,\n\"brands\":[list of brands] ,\n\"seasonal\":[list of seasonal],\n\"mealType\":[list of mealType] ,\n\"departments\":[list of departments]\n}\n\"\"\"\n\nprompt_test = f\"\"\"Here are the tags to consider when analyzing the image:\n<tags>\n{Tags}\n</tags>\nThe metadata JSON you generate should follow this format:\n<format>\n{expected_format}\n</format>\n\nPlease analyze the image and generate a metadata JSON according to the instructions below:\n\nINSTRUCTIONS:\n**Identifying Items:**\n1. List all the items that are visible in the image. Include the food items only if they are understandable, despite being blurred or partially visible. \n2. Add additional details if the item is fried, seared, roasted or grilled etc. \n3. For packaged items, use OCR to extract the generic product names from the labels, excluding brand names, variations, or detailed descriptions.  \n4. If flowers are present, mention the specific types of flowers.  \n5. Where items are visible in group, name individual items in the group. for example, flowers in bouquet, fruits in a bowl of fruit, etc. \n6. Output the list of primary items identified, or \"Not Applicable\" if none.  \n\n**Identifying probability match:**\n1. Provide a probability match between 0 and 100 describing how confident you are in identifying the items in the image.\n2. If your confidence changes for each item identified, give a median probability match.\n3. Score your results in increments of 1\n4. A score closer to 100 means higher probability match and closer to 0 means lower probability match in the results.\n\n**Identifying Brands and Banners:**\n1. Use OCR to extract text from the image that resembles brand names on product packaging or text that looks like banners/signage.\n2. Compare the extracted text EXACTLY with the items in the '\''\'\'''\''Banners'\''\'\'''\'' list provided above. If there'\''\'\'''\''s an exact match, output the matching banner. If no exact match is found, output \"Not Applicable\" for the banner.\n3. Compare the extracted text EXACTLY with the items in the '\''\'\'''\''Brands'\''\'\'''\'' list provided above. If there'\''\'\'''\''s an exact match, output the matching brand. If no exact match is found, output \"Not Applicable\" for the brand.\n4. Disregard any extracted text that doesn'\''\'\'''\''t match exactly with the provided lists, even if it seems similar to a brand or banner name.\n\n**Identifying Departments and Meal Types:**\n1. Classify the identified primary items into departments and meal types using the lists in the tags. Only classify items based on their actual appearance and function in the image.\n2. Output the list of matched departments and meal types. If no match, output \"Not Applicable\" for each.\n\n**Identifying Seasonal Events or Holidays:**\n1. Examine the image for thematic elements, decorations, activities or symbols that indicate a seasonal event or holiday from the tags list.\n2. Pay close attention to the specific details of the image, such as the colors, patterns, and objects present.\n3. Output the list of matched seasonal events/holidays. If none, output \"Not Applicable\".\n\n**Generating a Description:**\n1. Keep the main focus of the description on the elements listed above, namely grocery products, human activities, store names, and seasonal events or holiday occasions.\n2. Organize the description to highlight these key aspects and provide a clear understanding of the content depicted in the image.\n\n**Generating an alt-text:**\n1. Generate an Alt-text focused on the key elements identified: grocery products, human activities, store names, seasonal events.\n2. Organize the Alt-text to be precise and comprehensive in no more than 25 words to highlight these aspects and summarize the image.\n\n**Special Scenarios:**\n1. If the image shows storefronts/buildings with banners or signage:\n- Set items to only \"Storefront\". Exclude other items.\n- Set season, meal type, dietary preference and department to \"Not Applicable\".\n- Focus the description only on the banners and storefronts.\n2. If the image shows employees working or wearing attire with store branding:\n- Set items to only \"Employee\". Exclude other items.\n- Set season to \"Not Applicable\".\n- Summarize the banner and employee activity in the description.\n3. If the image shows human presence (other than employees) preparing or consuming food:\n- Include the depicted food preparation/consumption activities in the items list.\n- Include \"Holiday\" in the season.\n\nFinally, generate the metadata JSON in the specified format, strictly adhering to the structure provided in <format>.\n\nEnsure that brands, banners, seasonal, mealType, departments from the predefined lists in the tags are included in the output. If no exact matches are found, use [\"Not Applicable\"] for both banners and brands.\n\nEnsure that the output list of items does not contain duplicates. Instead, use plural forms for multiple identical items and list distinct varieties separately.\n\nRemember, do not make inferences beyond what is explicitly shown in the image. If any attribute does not apply, set it to \"Not Applicable\".\n\"\"\"\n\n**Example:**\n**Image:** A cake decorated with an American flag design and the word \"THANKFUL\" in blue frosting. There is a can of whipped cream, a slice of pie, and a cup of ice cream on the table. The tablecloth is red and white checkered.\n\n**Output:**\n{ \"items\": [ \"Cake\", \"Whipped Cream\", \"Pie\", \"Ice Cream\" ], \"probabilityMatch\": [ 95 ], \"description\": \"The image shows a red and white checkered tablecloth with a cake decorated with an American flag design and the word \"THANKFUL\" in blue frosting. There is a can of whipped cream, a slice of pie, and a cup of ice cream on the table. The scene suggests a celebratory gathering or a picnic.\", \"altText\": \"A red and white checkered tablecloth with a cake decorated with an American flag design and the word \"THANKFUL\" in blue frosting. There is a can of whipped cream, a slice of pie, and a cup of ice cream on the table.\", \"banners\": [ \"Not Applicable\" ], \"brands\": [ \"Not Applicable\" ], \"seasonal\": [ \"4th of July\", \"Holiday\" ], \"mealType\": [ \"Dessert\" ], \"departments\": [ \"Bakery\", \"Dairy\", \"Frozen\" ] }"
        },
        {
          "fileData": {
            "fileUri": "https://as1.ftcdn.net/v2/jpg/06/29/40/44/1000_F_629404497_oSoFRsciCkjnuCPBA5LCZHaOUNmAn09H.jpg",
            "mimeType": "image/jpeg"
          }
        }
      ]
    }],
    "safetySettings": [
      {
        "category": "HARM_CATEGORY_HATE_SPEECH",
        "threshold": "BLOCK_MEDIUM_AND_ABOVE"
      },
      {
        "category": "HARM_CATEGORY_DANGEROUS_CONTENT",
        "threshold": "BLOCK_MEDIUM_AND_ABOVE"
      },
      {
        "category": "HARM_CATEGORY_SEXUALLY_EXPLICIT",
        "threshold": "BLOCK_MEDIUM_AND_ABOVE"
      },
      {
        "category": "HARM_CATEGORY_HARASSMENT",
        "threshold": "BLOCK_MEDIUM_AND_ABOVE"
      }
    ],
    "generationConfig": {
      "temperature": 0,
      "maxOutputTokens": 8000
    }
  }'
